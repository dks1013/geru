const moduleName = "libzwfeyyadt.so";
const offset = 0x6DC4;

function waitForModule() {
    const base = Module.findBaseAddress(moduleName);
    if (base) {
        console.log("[+] module loaded at", base);

        const target = base.add(offset);
        hook(target);
        return;
    }

    setTimeout(waitForModule, 100);
}

function hook(target) {
    console.log("[+] target =", target);

    Stalker.follow(Process.getCurrentThreadId(), {
        events: { exec: true },
        onReceive(events) {
            const parsed = Stalker.parse(events);
            parsed.forEach(e => {
                if (e.address.equals(target)) {
                    console.log("X17 (after LDR) =", e.context.x17);
                }
            });
        }
    });
}

waitForModule();